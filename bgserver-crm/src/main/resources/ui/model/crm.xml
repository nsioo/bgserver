<!--
  ~ /*
  ~  *
  ~  *  *
  ~  *  *  * Copyright (c) Shanghai Xing Ye, Co. Ltd.
  ~  *  *  * https://bg.work
  ~  *  *  *
  ~  *  *  * GNU Lesser General Public License Usage
  ~  *  *  * Alternatively, this file may be used under the terms of the GNU Lesser
  ~  *  *  * General Public License version 3 as published by the Free Software
  ~  *  *  * Foundation and appearing in the file LICENSE.txt included in the
  ~  *  *  * project of this file. Please review the following information to
  ~  *  *  * ensure the GNU Lesser General Public License version 3 requirements
  ~  *  *  * will be met: https://www.gnu.org/licenses/lgpl-3.0.html.
  ~  *  *
  ~  *
  ~  */
  ~
  -->
<ui>
    <inherit>
        <xpath expression="/ui/model[@app='core'][@name='partner']/view/edit" op="append" app="core">
            <field name="events" style="relation"/>
            <field name="customers" style="relation"/>
            <field name="leads" style="relation"/>
            <field name="orderInvoices" style="relation"/>
            <field name="orderReceipts" style="relation"/>
        </xpath>

        <xpath expression="/ui/model[@app='core'][@name='partner']/view/detail" op="append" app="core">
            <field name="events" style="relation"/>
            <field name="customers" style="relation"/>
            <field name="leads" style="relation"/>
            <field name="orderInvoices" style="relation"/>
            <field name="orderReceipts" style="relation"/>
        </xpath>

        <xpath expression="/ui/model[@app='product'][@name='product']/view/detail" op="append" app="product">
            <field name="customerOpportunities" style="relation"/>
        </xpath>
        <xpath expression="/ui/model[@app='product'][@name='product']/view/edit" op="append" app="product">
            <field name="customerOpportunities" style="relation"/>
        </xpath>
    </inherit>

    <model name="customer" app="crm">
        <view type="crmCustomerFollowView">

        </view>
        <view type="searchBox">
            <field name="name" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>
        </view>

        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub|singleSelection"/>
                    </action>

                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>

                    <action>
                        <group name="selSingleItemAction" refType="singleSelection"/>
                    </action>
                </actions>
                <views>
                    <view type="searchBox" refType="embedded"/>
                </views>
            </ref>
            <field name="id" type="static"/>
            <field name="name" type="static" style="head"/>
            <field name="isCorp" type="enumStatic" style="head">
                <meta>
                    <![CDATA[
                    {
                     "0":"否",
                     "1":"是"
                    }
                  ]]>
                </meta>
            </field>
            <field name="event.name" type="static"/>
            <field name="mobile" type="static"/>
            <field name="fax" type="static"/>
            <field name="telephone" type="static"/>
            <field name="email" type="static"/>
            <field name="website" type="static"/>
            <field name="sex" type="enumStatic">
                <meta>
                    <![CDATA[
                        {
                        "-1":"未知",
                        "1":"男",
                        "0":"女"
                        }
                    ]]>
                </meta>
            </field>
            <field name="birthday" type="static"/>
            <field name="comment" type="static"/>
        </view>

        <view type="create">
            <ref>

                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>

                <views>
                    <view type="list"
                          ownerField="contactAddresses"
                          model="customerContactAddress"
                          refType="main|sub"/>
                    <view type="list"
                          ownerField="opportunities"
                          model="customerOpportunity"
                          refType="main|sub"/>
                    <view type="list"
                          ownerField="partners"
                          model="crmPartnerCustomerRel"
                          refType="main|sub"/>
                </views>

            </ref>
            <field name="name" type="singleLineText" style="head" title="公司|姓名"/>
            <field name="isCorp" type="singleCheckbox" style="head"/>
            <field name="event.name" type="selectModelFromListView"/>
            <field name="mobile" type="singleLineText"/>
            <field name="fax" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="email" type="singleLineText"/>
            <field name="department" type="singleLineText"/>
            <field name="sex"  type="select" visible="isCorp!=1">
                <meta>
                    <![CDATA[
                        {
                            "options":[
                            {"value":-1,"text":"未知"},
                            {"value":0,"text":"女"},
                            {"value":1,"text":"男"}
                            ]
                        }
                    ]]>
                </meta>
            </field>
            <field name="website" type="singleLineText"/>
            <field name="birthday" type="date" visible="isCorp!=1"/>
            <field name="fullAddress" type="chinaFullAddress"/>
            <field name="comment" type="singleLineText"/>
            <field name="contactAddresses" style="relation"/>
            <field name="opportunities" style="relation"/>
            <field name="partners" style="relation"/>
        </view>

        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list"
                          ownerField="contactAddresses"
                          model="customerContactAddress"
                          refType="main|sub"/>
                    <view type="list"
                          ownerField="opportunities"
                          model="customerOpportunity"
                          refType="main|sub"/>
                    <view type="list"
                          ownerField="partners"
                          model="crmPartnerCustomerRel"
                          refType="main|sub"/>
                </views>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="isCorp" type="singleCheckbox" style="head"/>
            <field name="event.name" type="selectModelFromListView"/>
            <field name="mobile" type="singleLineText"/>
            <field name="fax" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="email" type="singleLineText"/>
            <field name="department" type="singleLineText"/>
            <field name="sex"  type="select" visible="isCorp!=1">
                <meta>
                    <![CDATA[
                        {
                            "options":[
                            {"value":-1,"text":"未知"},
                            {"value":0,"text":"女"},
                            {"value":1,"text":"男"}
                            ]
                        }
                    ]]>
                </meta>
            </field>
            <field name="website" type="singleLineText"/>
            <field name="birthday" type="date" visible="isCorp!=1"/>
            <field name="fullAddress" type="chinaFullAddress"/>
            <field name="comment" type="singleLineText"/>
            <field name="contactAddresses" style="relation"/>
            <field name="opportunities" style="relation"/>
            <field name="partners" style="relation"/>
        </view>

        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>

                </actions>
                <views>
                    <view type="list"
                          ownerField="contactAddresses"
                          model="customerContactAddress"
                          refType="none"/>
                    <view type="list"
                          ownerField="opportunities"
                          model="customerOpportunity"
                          refType="none"/>
                    <view type="list"
                          ownerField="partners"
                          model="crmPartnerCustomerRel"
                          refType="none"/>
                    <view type="detail"
                          ownerField="commPartner"
                          model="partner"
                          app="core"
                          refType="none"/>
                    <view type="eventLogList"
                          refType="none"
                          ownerField="eventLogs"
                          model="modelLog"/>
                </views>
            </ref>
            <field name="name" type="static" style="head"/>
            <field name="isCorp" type="enumStatic" style="head">
                <meta>
                    <![CDATA[
                    {
                     "0":"否",
                     "1":"是"
                    }
                  ]]>
                </meta>
            </field>
            <field name="event.name" type="static"/>
            <field name="mobile" type="static"/>
            <field name="fax" type="static"/>
            <field name="telephone" type="static"/>
            <field name="email" type="static"/>
            <field name="department" type="static"/>
            <field name="sex"  type="enumStatic" visible="isCorp!=1">
                <meta>
                    <![CDATA[
                        {
                        "-1":"未知",
                        "1":"男",
                        "0":"女"
                        }
                    ]]>
                </meta>
            </field>
            <field name="website" type="static"/>
            <field name="birthday" type="static" visible="isCorp!=1"/>
            <field name="fullAddress" type="chinaFullAddressStatic"/>
            <field name="comment" type="static"/>
            <field name="contactAddresses" style="relation"/>
            <field name="opportunities" style="relation"/>
            <field name="partners" style="relation"/>
            <field name="commPartner" style="relation"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
    </model>

    <model name="event" app="crm">

        <view type="searchBox">
            <field name="name" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>
        </view>

        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="searchBox" refType="embedded"/>
                </views>
            </ref>
            <field name="id" type="static"/>
            <field name="name" type="static" style="head"/>
            <field name="budgetCost" type="static" style="head"/>
            <field name="actualCost" type="static"/>
            <field name="startTime" type="static"/>
            <field name="endTime" type="static"/>
            <field name="comment" type="static"/>
        </view>

        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerEventRel" ownerField="magPartners" refType="sub"/>
                    <view type="list" model="lead" ownerField="leads" refType="sub"/>
                    <view type="list" model="customer" ownerField="customers" refType="sub"/>
                </views>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="budgetCost" type="singleLineText" style="subHead"/>
            <field name="actualCost" type="singleLineText" style="subHead"/>
            <field name="startTime" type="date"/>
            <field name="endTime" type="date"/>
            <field name="comment" type="multiLineText"/>
            <field name="magPartners" style="relation"/>
            <field name="leads" style="relation"/>
            <field name="customers" style="relation"/>
        </view>

        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerEventRel" ownerField="magPartners" refType="sub"/>
                </views>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="budgetCost" type="singleLineText" style="subHead"/>
            <field name="actualCost" type="singleLineText" style="subHead"/>
            <field name="startTime" type="date"/>
            <field name="endTime" type="date"/>
            <field name="comment" type="multiLineText"/>
            <field name="magPartners" style="relation"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerEventRel" ownerField="magPartners" refType="none"/>
                    <view type="list" model="lead" ownerField="leads" refType="none"/>
                    <view type="list" model="customer" ownerField="customers" refType="none"/>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="name" type="static" style="head"/>
            <field name="budgetCost" type="static" style="subHead"/>
            <field name="actualCost" type="static" style="subHead"/>
            <field name="startTime" type="static"/>
            <field name="endTime" type="static"/>
            <field name="comment" type="static"/>
            <field name="magPartners" style="relation"/>
            <field name="leads" style="relation"/>
            <field name="customers" style="relation"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="lead" app="crm">

        <view type="searchBox">
            <field name="name" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>
            <field name="corpName" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>
            <field name="mobile" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>

            <field name="telephone" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>

        </view>

        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="searchBox" refType="embedded"/>
                </views>
            </ref>
            <field name="id" type="static" style="head"/>
            <field name="name" type="static" style="head"/>
            <field name="corpName" type="static"/>
            <field name="mobile" type="static"/>
            <field name="telephone" type="static"/>
            <field name="fax" type="static"/>
            <field name="commPartner.name" type="static"/>
            <field name="event.name" type="static"/>
            <field name="interactionStatus.name" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerLeadRel" ownerField="partners" refType="main|sub"/>
                    <view type="detail" model="partner" ownerField="commPartner" refType="none"/>
                    <view type="list" model="leadCustomerCommunicationHistory" ownerField="communications"
                          refType="none"/>
                </views>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="interactionStatus.name" type="selectModelFromListView" style="head"/>
            <field name="event.name" type="selectModelFromListView"/>
            <field name="corpName" type="singleLineText"/>
            <field name="mobile" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="fax" type="singleLineText"/>
            <field name="fullAddress" type="chinaFullAddress"/>
            <field name="partners" style="relation"/>
            <field name="commPartner" style="relation"/>
            <field name="communications" style="relation"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerLeadRel" ownerField="partners" refType="main|sub"/>
                </views>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="interactionStatus.name" type="selectModelFromListView" style="head"/>
            <field name="event.name" type="selectModelFromListView"/>
            <field name="corpName" type="singleLineText"/>
            <field name="mobile" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="fax" type="singleLineText"/>
            <field name="fullAddress" type="chinaFullAddress"/>

            <field name="partners" style="relation"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="createCustomerFromLeadAndToCustomer" refType="main|sub">
                            <trigger name="createCustomer"
                                     visible="toCustomer.id=0 or toCustomer.id=null or toCustomer.id=undefined" actionName="createCustomer">
                                <meta>
                                    <![CDATA[
                                        {
                                         "title":"提示",
                                         "message":"确定要生成客户吗？"
                                        }
                                      ]]>
                                </meta>
                            </trigger>
                            <trigger name="toCustomer" visible="toCustomer.id>0" actionName="toCustomer">
                                <meta>
                                    <![CDATA[{"action":"redirect","toView":"detail","toApp":"crm","toModel":"customer","fieldName":"toCustomer"}]]>
                                </meta>
                            </trigger>
                        </group>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmPartnerLeadRel" ownerField="partners" refType="none"/>
                    <view type="detail" model="partner" ownerField="commPartner" refType="none"/>
                    <view type="list" model="leadCustomerCommunicationHistory"
                          ownerField="communications"
                          refType="none"/>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="name" type="static" style="head"/>
            <field name="interactionStatus.name" type="static" style="head"/>
            <field name="event.name" type="static"/>
            <field name="corpName" type="static"/>
            <field name="mobile" type="static"/>
            <field name="telephone" type="static"/>
            <field name="fax" type="static"/>
            <field name="toCustomer" type="static" visible="false"/>
            <field name="fullAddress" type="chinaFullAddressStatic"/>
            <field name="partners" style="relation"/>
            <field name="commPartner" style="relation"/>
            <field name="communications" style="relation"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="leadInteractionStatus" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub|main|singleSelection"/>
                    </action>
                    <action>
                        <group name="selSingleItemAction" refType="singleSelection"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static"/>
            <field name="name" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main"/>
                    </action>
                </actions>
            </ref>

            <field name="name" type="singleLineText" style="head"/>
            <field name="leads" style="relation"/>
        </view>
    </model>
    <model name="leadCustomerCommunicationHistory" app="crm">
        <view type="list">
            <field name="id" type="singleLineText" style="head"/>
            <field name="content" type="singleLineText" style="head"/>
            <field name="createTime" type="singleLineText" style="head"/>
        </view>
        <view type="create">
            <field name="content" type="singleLineText"/>
        </view>
        <view type="edit">
            <field name="content" type="singleLineText"/>
        </view>
        <view type="detail">
            <field name="content" type="singleLineText"/>
        </view>
    </model>
    <model name="customerContactAddress" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static" style="head"/>
            <field name="name" type="static" style="head"/>
            <field name="mobile" type="static"/>
            <field name="telephone" type="static"/>
            <field name="email" type="static"/>
            <field name="department" type="static"/>
            <field name="sex" type="enumStatic">
                <meta>
                    {
                    "-1":"未知",
                    "0":"女",
                    "1":"男"
                    }
                </meta>
            </field>
            <field name="birthday" type="date"/>
            <field name="comment" type="static"/>
        </view>
        <div type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="mobile" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="email" type="singleLineText"/>
            <field name="department" type="singleLineText"/>
            <field name="sex" type="select">
                <meta>
                    <![CDATA[
                        {
                            "options":[
                            {"value":-1,"text":"未知"},
                            {"value":0,"text":"女"},
                            {"value":1,"text":"男"}
                            ]
                        }
                    ]]>
                </meta>
            </field>
            <field name="birthday" type="date"/>
            <field name="comment" type="singleLineText"/>
        </div>
        <div type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="mobile" type="singleLineText"/>
            <field name="telephone" type="singleLineText"/>
            <field name="email" type="singleLineText"/>
            <field name="department" type="singleLineText"/>
            <field name="sex" type="select">
                <meta>
                    <![CDATA[
                        {
                            "options":[
                            {"value":-1,"text":"未知"},
                            {"value":0,"text":"女"},
                            {"value":1,"text":"男"}
                            ]
                        }
                    ]]>
                </meta>
            </field>
            <field name="birthday" type="date"/>
            <field name="comment" type="singleLineText"/>
        </div>
        <div type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="name" type="static" style="head"/>
            <field name="mobile" type="static"/>
            <field name="telephone" type="static"/>
            <field name="email" type="static"/>
            <field name="department" type="static"/>
            <field name="sex" type="enumStatic">
                <meta>
                    {
                    "-1":"未知",
                    "0":"女",
                    "1":"男"
                    }
                </meta>
            </field>
            <field name="birthday" type="date"/>
            <field name="comment" type="singleLineText"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </div>
    </model>
    <model name="customerOpportunity" app="crm">


        <view type="searchBox">
            <field name="title" type="criteriaStringEqual">
                <meta>
                    <![CDATA[
                    {
                      "skipValue":["",null,undefined]
                    }
                  ]]>
                </meta>
            </field>


        </view>

        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="searchBox" refType="embedded"/>
                </views>
            </ref>
            <field name="id" type="static"/>
            <field name="title" type="static"/>
            <field name="customer.name" type="static"/>
            <field name="price" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" ownerField="products" model="crmCustomerOpportunityOrderProductRel" refType="sub"/>
                </views>
            </ref>
            <field name="title" type="singleLineText" style="head"/>
            <field name="price" type="real"/>
            <field name="customer.name" type="selectModelFromListView"/>
            <field name="products" style="relation"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" ownerField="products" model="crmCustomerOpportunityOrderProductRel"
                          refType="main|sub"/>
                </views>
            </ref>
            <field name="title" type="singleLineText" style="head"/>
            <field name="price" type="real"/>
            <field name="customer.name" type="selectModelFromListView"/>
            <field name="products" style="relation"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="createOrEditQuotation" refType="main|sub">
                            <trigger model="customerOpportunityOrderQuotation" ownerField="quotation" viewType="create" name="createQuotation"
                                     visible="quotation.id=null or quotation.id=undefined or quotation.id&lt;1"/>
                            <trigger model="customerOpportunityOrderQuotation" ownerField="quotation" viewType="edit" name="editQuotation"
                                     visible="quotation.id&gt;0"/>
                        </group>

                        <group name="createOrGotoOrder" refType="main|sub">
                            <trigger model="customerOrder" ownerField="order" viewType="create" name="createOrder"
                                     visible="quotation.id&gt;0 and (order.id=undefined or order.id=null or order.id&lt;1)"/>
                            <trigger model="customerOrder" ownerField="order" viewType="detail" name="gotoOrderDetail"
                                     visible="quotation.id&gt;0 and order.id&gt;0"/>
                        </group>

                    </action>
                </actions>
                <views>
                    <view type="list" ownerField="products" model="crmCustomerOpportunityOrderProductRel" refType="none"/>
                    <view type="detail" ownerField="customer" model="customer" refType="none"/>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="title" type="static" style="head"/>
            <field name="price" type="static"/>
            <field name="quotation" style="relation" visible="false"/>
            <field name="order" style="relation" visible="false"/>
            <field name="customer" style="relation"/>
            <field name="products" style="relation"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="customerOpportunityOrderQuotation" app="crm">
        <view type="list">
            <ref>
                <actions>
<!--                    <action>-->
<!--                        <group name="main" refType="main|sub"/>-->
<!--                    </action>-->
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static" style="head"/>
            <field name="opportunity.title" type="static"/>
            <field name="order.title" type="static"/>
            <field name="tpl.name" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="tpl.name" type="selectModelFromListView" style="head"/>
            <field name="opportunity.title" type="singleLineText" style="subHead" enable="false"/>
            <field name="order.title" type="singleLineText" style="subHead" enable="false"/>
            <field name="comment" type="multiLineText"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="tpl.name" type="selectModelFromListView" style="head"/>
            <field name="opportunity.title" type="singleLineText" style="subHead" enable="false"/>
            <field name="order.title" type="singleLineText" style="subHead" enable="false"/>
            <field name="comment" type="multiLineText"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="detail" ownerField="tpl" model="customerOpportunityOrderQuotationTemplate" refType="none"/>
                    <view type="detail" ownerField="order" model="customerOrder" refType="none"/>
                    <view type="detail" ownerField="opportunity" model="customerOpportunity" refType="none"/>
                </views>
            </ref>
<!--            <field name="opportunity.title" type="singleLineText" style="subHead" enable="false"/>-->

            <field name="comment" type="static"/>
            <field name="tpl" style="relation"/>
            <field name="order"  style="relation"/>
            <field name="opportunity" style="relation"/>
        </view>
    </model>
    <model name="customerOrder" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static" style="head"/>
            <field name="title" type="static" style="head"/>
            <field name="price" type="static"/>
            <field name="customer.name" type="static"/>
            <field name="opportunity.title" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>

                <views>
                    <view type="list" model="crmCustomerOpportunityOrderProductRel"  ownerField="products" refType="main|sub"/>
                    <view type="detail" model="customer"  ownerField="customer" refType="none"/>
                    <view type="detail" model="customerOpportunity"  ownerField="opportunity" refType="none"/>
                </views>

            </ref>

            <field name="title" type="singleLineText" style="head"/>
            <field name="price" type="singleLineText"/>
            <field name="opportunity" style="relation"/>
            <field name="products" style="relation"/>
            <field name="customer" style="relation"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="list" model="crmCustomerOpportunityOrderProductRel"  ownerField="products" refType="main|sub"/>
                </views>
            </ref>
            <field name="title" type="singleLineText" style="head"/>
            <field name="price" type="singleLineText"/>
            <field name="customer.name" type="selectModelFromListView" enable="opportunity=undefined or opportunity.id&lt;1"/>
            <field name="opportunity.title" type="singleLineText" enable="false"/>
            <field name="products" style="relation"  visible="opportunity=undefined or opportunity.id&lt;1"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="confirmOrderProcess" refType="main|sub">
                            <trigger title="确认订单"
                                     model="customerOrder"
                                     viewType="modelAction"
                                     name="order_step"
                                     visible="step=0"
                                     actionName="confirmCustomerOrder"/>
                            <trigger title="通知订单状态"
                                     model="customerOrder"
                                     viewType="modelAction"
                                     name="order_step2"
                                     visible="step&gt;0"
                                     enable="step&gt;0"
                                     actionName="notifyOrderStepBySmsEmail"/>
                            <trigger title="开具发票/收据"
                                     model="customerOrderInvoice"
                                     viewType="create"
                                     ownerField="invoice"
                                     name="order_step3"
                                     visible="step=1"/>
                            <trigger title="发票/收据"
                                     model="customerOrderInvoice"
                                     viewType="edit"
                                     name="order_step4"
                                     ownerField="invoice"
                                     visible="step&gt;1"
                                     enable="step&gt;1"/>
                            <trigger title="确认回款"
                                     model="customerOrder"
                                     viewType="modelAction"
                                     name="order_step5"
                                     visible="step=2"
                                     actionName="confirmOrderPayment"/>
                        </group>
                    </action>
                </actions>

                <views>
                    <view type="list" model="crmCustomerOpportunityOrderProductRel"  ownerField="products" refType="none"/>
                    <view type="detail" model="customer"  ownerField="customer" refType="none"/>
                    <view type="detail" model="customerOpportunity"  ownerField="opportunity" refType="none"/>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="title" type="static" style="head"/>
            <field name="price" type="static"/>
            <field name="step" type="static"/>
            <field name="invoice" style="relation" visible="false"/>
            <field name="opportunity" style="relation"/>
            <field name="products" style="relation"/>
            <field name="customer" style="relation"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
        <view type="modelAction">
            <ref>
                <actions>
                    <action>
                       <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="sms" type="multiLineText" style="head"/>
            <field name="mail" type="multiLineText"/>
        </view>
    </model>
    <model name="customerOrderInvoice" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"></group>
                    </action>
                    <action>
                        <group name="selSingleItemAction" refType="singleSelection"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static" style="head"/>
            <field name="fromCorpName" type="static"/>
            <field name="toCorpName" type="static"/>
            <field name="amount" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="fromCorpName" type="singleLineText" style="head"/>
            <field name="toCorpName" type="singleLineText" style="head"/>
            <field name="amount" type="singleLineText"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="fromCorpName" type="singleLineText" style="head"/>
            <field name="toCorpName" type="singleLineText" style="head"/>
            <field name="amount" type="singleLineText"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
                <views>
                    <view type="eventLogList" refType="none" ownerField="eventLogs" model="modelLog" app="core"/>
                </views>
            </ref>
            <field name="fromCorpName" type="static"/>
            <field name="toCorpName" type="static"/>
            <field name="amount" type="static"/>
            <field name="eventLogs" style="relation">
                <meta>
                    <![CDATA[
                        {
                         "controlActions":[{"editor":"modelCommentControlEditor","title":"跟踪"}]
                        }
                      ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="crmCustomerOpportunityOrderProductRel" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="product.name"/>
            <field name="count"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="product.name" type="selectModelFromListView" style="head"/>
            <field name="count" type="singleLineText"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="product.name" type="selectModelFromListView" style="head"/>
            <field name="count" type="singleLineText"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main"/>
                    </action>
                </actions>
            </ref>
            <field name="product.name" type="static" style="head"/>
            <field name="count" type="static"/>
        </view>
    </model>
    <model name="crmPartnerCustomerRel" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="selSingleItemAction" refType="singleSelection"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="static" style="head"/>
            <field name="ownFlag" type="enumStatic">
                <meta>
                    {
                    "1":"所有",
                    "0":"辅助"
                    }
                </meta>
            </field>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="selectModelFromListView" style="head"/>
            <field name="ownFlag" type="singleCheckbox"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="selectModelFromListView" style="head"/>
            <field name="ownFlag" type="singleCheckbox"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="static" style="head"/>
            <field name="ownFlag" type="enumStatic">
                <meta>
                    {
                    "1":"所有",
                    "0":"辅助"
                    }
                </meta>
            </field>
        </view>
    </model>
    <model name="crmPartnerEventRel" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="sub"/>
                    </action>
                </actions>
            </ref>

            <field name="id" type="static"/>
            <field name="partner.name" type="static"/>
            <field name="mainFlag" type="enumStatic">
                <meta>
                    <![CDATA[
                       {
                         "0":"否",
                         "1":"是"
                       }
                    ]]>
                </meta>
            </field>

        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.userName" type="selectModelFromListView" style="head"/>
            <field name="mainFlag" type="singleCheckbox"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="selectModelFromListView" style="head"/>
            <field name="mainFlag" type="singleCheckbox">
                <meta>
                    <![CDATA[
                       {
                         "label":"主要负责人"
                       }
                    ]]>
                </meta>
            </field>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="static" style="head"/>
            <field name="mainFlag" type="enumStatic">
                <meta>
                    <![CDATA[
                    {
                    "0":"否",
                    "1":"是"
                    }
                    ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="crmPartnerLeadRel" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                    <action>
                        <group name="opAction" refType="sub"/>
                    </action>
                </actions>
            </ref>

            <field name="id" type="static"/>
            <field name="partner.name" type="static"/>
            <field name="mainFlag" type="enumStatic">
                <meta>
                    <![CDATA[
                       {
                         "0":"否",
                         "1":"是"
                       }
                    ]]>
                </meta>
            </field>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.userName" type="selectModelFromListView" style="head"/>
            <field name="mainFlag" type="singleCheckbox"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="selectModelFromListView" style="head"/>
            <field name="mainFlag" type="singleCheckbox">
                <meta>
                    <![CDATA[
                       {
                         "label":"主要负责人"
                       }
                    ]]>
                </meta>
            </field>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="sub"/>
                    </action>
                </actions>
            </ref>
            <field name="partner.name" type="static" style="head"/>
            <field name="mainFlag" type="enumStatic">
                <meta>
                    <![CDATA[
                    {
                    "0":"否",
                    "1":"是"
                    }
                    ]]>
                </meta>
            </field>
        </view>
    </model>
    <model name="customerOpportunityOrderQuotationTemplate" app="crm">
        <view type="list">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub|singleSelection"/>
                    </action>
                    <action>
                        <group name="opAction" refType="main|sub"/>
                    </action>
                    <action>
                        <group name="selSingleItemAction" refType="singleSelection"/>
                    </action>
                </actions>
            </ref>
            <field name="id" type="static"/>
            <field name="name" type="static"/>
            <field name="comment" type="static"/>
        </view>
        <view type="edit">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="tpl" type="multiLineText"/>
            <field name="comment" type="multiLineText"/>
        </view>
        <view type="create">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="singleLineText" style="head"/>
            <field name="tpl" type="multiLineText"/>
            <field name="comment" type="multiLineText"/>
        </view>
        <view type="detail">
            <ref>
                <actions>
                    <action>
                        <group name="main" refType="main|sub"/>
                    </action>
                </actions>
            </ref>
            <field name="name" type="static" style="head"/>
            <field name="tpl" type="static"/>
            <field name="comment" type="static"/>
        </view>
    </model>
</ui>